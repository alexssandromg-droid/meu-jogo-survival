<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Amap√°</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #2c3e50; color: white; font-family: 'Roboto', sans-serif; text-align: center; margin: 0; padding: 20px; }
        
        /* Telas */
        .screen { display: none; max-width: 600px; margin: 0 auto; }
        #login-screen { display: block; } /* Come√ßa aqui */

        /* Estilos Gerais */
        input { padding: 15px; font-size: 18px; border-radius: 5px; width: 80%; border: none; margin-bottom: 10px; }
        button { padding: 15px 30px; font-size: 18px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; }
        button:hover { background: #2ecc71; }
        
        /* Lobby */
        .player-card { background: #34495e; padding: 10px; margin: 5px 0; border-radius: 5px; display: flex; justify-content: space-between; }
        
        /* Jogo */
        #timer-bar { height: 10px; background: #e74c3c; width: 100%; transition: width linear; margin-bottom: 15px; border-radius: 5px; }
        .question-box { background: #ecf0f1; color: #2c3e50; padding: 20px; border-radius: 10px; margin-bottom: 20px; font-size: 18px; font-weight: bold; }
        
        .opt-btn { background: #34495e; text-align: left; margin-bottom: 8px; border: 2px solid transparent; width: 100%; padding: 10px; border-radius: 5px; cursor: pointer; color: white; font-size: 16px; }
        .opt-btn:hover { background: #2c3e50; }
        .opt-btn.selected { border-color: #f1c40f; background: #2c3e50; }
        .opt-btn.correct { background: #27ae60 !important; }
        .opt-btn.wrong { background: #c0392b !important; opacity: 0.6; }

        /* Explica√ß√£o */
        #feedback-box { background: #f1c40f; color: #000; padding: 15px; border-radius: 10px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen">
        <h1>üìö Quiz Hist√≥ria do Amap√°</h1>
        <p>Digite seu nome para entrar:</p>
        <input type="text" id="username" placeholder="Nome">
        <button onclick="entrar()">ENTRAR NA SALA</button>
    </div>

    <div id="lobby-screen" class="screen">
        <h2>Sala de Espera</h2>
        <div id="lobby-list"></div>
        <br>
        <button id="btn-start" onclick="iniciar()" style="display:none; background:#e67e22">COME√áAR O QUIZ</button>
        <p id="wait-msg">Aguardando o l√≠der iniciar...</p>
    </div>

    <div id="game-screen" class="screen">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span id="q-num">Quest√£o 1</span>
            <span id="my-pts">Meus Pontos: 0</span>
        </div>
        <div style="width:100%; background:#555; border-radius:5px;"><div id="timer-bar"></div></div>
        
        <div class="question-box" id="q-text">...</div>
        <div id="options-area"></div>

        <div id="feedback-box">
            <h3>Gabarito:</h3>
            <p id="feedback-text"></p>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h1>FIM DE JOGO! üèÜ</h1>
        <div id="ranking-list"></div>
        <button onclick="location.reload()">JOGAR NOVAMENTE</button>
    </div>

    <script>
        const socket = io();
        let meuId = null;
        let jaRespondi = false;

        // Fun√ß√µes de Navega√ß√£o
        function show(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        function entrar() {
            const nome = document.getElementById('username').value;
            if(!nome) return alert("Coloque um nome!");
            socket.emit('entrar', nome);
            show('lobby-screen');
        }

        function iniciar() {
            socket.emit('iniciarJogo');
        }

        // SOCKET EVENTOS
        socket.on('connect', () => meuId = socket.id);

        socket.on('atualizarLista', (lista) => {
            // Atualiza lista do lobby
            const div = document.getElementById('lobby-list');
            div.innerHTML = lista.map(p => 
                `<div class="player-card">
                    <span>${p.nome}</span>
                    <span>${p.pontos} pts</span>
                 </div>`
            ).join('');

            // Se for o primeiro (host), mostra bot√£o de start
            if(lista.length > 0 && lista[0].id === meuId) {
                document.getElementById('btn-start').style.display = 'block';
                document.getElementById('wait-msg').style.display = 'none';
            }

            // Atualiza pontos no jogo
            const eu = lista.find(p => p.id === meuId);
            if(eu) document.getElementById('my-pts').innerText = `Pontos: ${eu.pontos}`;
        });

        socket.on('novaQuestao', (d) => {
            show('game-screen');
            jaRespondi = false;
            document.getElementById('feedback-box').style.display = 'none';
            
            // Preenche textos
            document.getElementById('q-text').innerText = d.pergunta;
            document.getElementById('q-num').innerText = `Quest√£o ${d.atual}/${d.totalQuestoes}`;

            // Cria bot√µes
            const area = document.getElementById('options-area');
            area.innerHTML = '';
            Object.keys(d.opcoes).forEach(key => {
                let btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.id = `btn-${key}`;
                btn.innerText = `${key.toUpperCase()}) ${d.opcoes[key]}`;
                btn.onclick = () => responder(key);
                area.appendChild(btn);
            });

            // Anima√ß√£o do Timer
            const bar = document.getElementById('timer-bar');
            bar.style.transition = 'none';
            bar.style.width = '100%';
            setTimeout(() => {
                bar.style.transition = `width ${d.tempo}s linear`;
                bar.style.width = '0%';
            }, 50);
        });

        function responder(key) {
            if(jaRespondi) return;
            jaRespondi = true;
            document.getElementById(`btn-${key}`).classList.add('selected');
            // Desabilita cliques
            document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
            socket.emit('responder', key);
        }

        socket.on('resultadoRodada', (d) => {
            // Pinta a certa de verde
            const btnCerto = document.getElementById(`btn-${d.correta}`);
            if(btnCerto) btnCerto.classList.add('correct');

            // Se errei, pinta a minha de vermelho
            const selecionado = document.querySelector('.selected');
            if(selecionado && selecionado.id !== `btn-${d.correta}`) {
                selecionado.classList.add('wrong');
            }

            // Mostra explica√ß√£o
            const box = document.getElementById('feedback-box');
            document.getElementById('feedback-text').innerText = d.explicacao;
            box.style.display = 'block';
        });

        socket.on('fimDeJogo', (ranking) => {
            show('result-screen');
            const div = document.getElementById('ranking-list');
            div.innerHTML = ranking.map((p, i) => 
                `<div class="player-card" style="font-size: 20px;">
                    #${i+1} ${p.nome} 
                    <b>${p.pontos} pts</b>
                 </div>`
            ).join('');
        });

    </script>
</body>
</html>