<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survival Royale: TEAMS</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* CORES DOS TIMES */
            --team-green: #00e676;
            --team-blue: #00b0ff;
            --team-red: #ff1744;
            --team-yellow: #ffea00;
            --bg-dark: #050505;
        }
        body { background-color: var(--bg-dark); color: #e0e0e0; font-family: 'Rajdhani', sans-serif; margin: 0; height: 100vh; overflow: hidden; user-select: none; display: flex; flex-direction: column; }

        /* ESTILOS DOS JOGADORES NA LISTA */
        .player-item { background: #151515; padding: 8px; margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid transparent; }
        .player-item.p1 { border-left-color: var(--team-green); } 
        .player-item.p2 { border-left-color: var(--team-blue); }
        .player-item.p3 { border-left-color: var(--team-red); } 
        .player-item.p4 { border-left-color: var(--team-yellow); }
        .player-item.turn { background: #333; border-right: 3px solid white; }
        .player-item.dead { text-decoration: line-through; opacity: 0.4; }

        /* APOSTA MODAL */
        #betting-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .bet-container { display: flex; gap: 30px; }
        .bet-btn { width: 150px; height: 150px; background: #222; border: 4px solid #555; border-radius: 10px; color: white; font-size: 20px; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.3s; }
        .bet-btn:hover { transform: scale(1.1); background: #333; }
        .bet-btn.selected { background: white; color: black; border-color: gold; }

        /* TABULEIRO */
        #board-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; z-index: 2000; flex-direction: column; justify-content: flex-start; align-items: center; padding-top: 20px; }
        .board-track { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; max-width: 90%; margin-top: 20px; }
        .board-cell { width: 40px; height: 40px; border: 1px solid #444; background: #222; display: flex; justify-content: center; align-items: center; font-size: 12px; color: #555; position: relative; }
        .board-cell.trap { border-color: red; background: #330000; }
        .board-cell.finish { border-color: gold; background: #333300; }
        .p-token { width: 20px; height: 20px; border-radius: 50%; position: absolute; box-shadow: 0 0 5px black; font-size: 10px; display:flex; justify-content:center; align-items:center; color:black; font-weight:bold; }
        
        #dice-btn { font-size: 50px; background: none; border: 2px solid white; color: white; border-radius: 10px; width: 100px; height: 100px; cursor: pointer; margin-top:20px; }
        #dice-btn:disabled { opacity: 0.3; }

        /* VOTA√á√ÉO */
        #voting-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 999; flex-direction: column; justify-content: center; align-items: center; }
        .vote-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 800px; padding: 10px; max-height: 60vh; overflow-y: auto;}
        .vote-btn { background: #222; border: 2px solid #555; color: white; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; text-transform: uppercase; }
        .vote-btn:hover { background: #444; border-color: white; }

        /* GERAL */
        #btn-admin-toggle { position: absolute; top: 20px; left: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #333; z-index: 300; }
        .online-badge { position: absolute; top: 20px; right: 20px; background: #111; border: 1px solid #333; padding: 5px 15px; border-radius: 20px; color: var(--team-green); font-size: 14px; }
        
        #admin-panel { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 400; flex-direction: column; justify-content: center; align-items: center; }
        .admin-card { background: #1a1a1a; padding: 20px; border: 1px solid white; border-radius: 10px; width: 300px; }
        .admin-row { margin-bottom: 10px; }
        .admin-row input, .admin-row select { width: 100%; padding: 5px; background: #000; border: 1px solid #444; color: white; box-sizing: border-box; }
        .btn-admin { padding: 10px; width: 100%; cursor: pointer; margin-top:5px; }

        #main-menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 200; }
        .logo-title { font-size: 60px; color: white; margin-bottom: 20px; text-shadow: 0 0 10px var(--team-blue); }
        .menu-card { background: rgba(20, 20, 20, 0.9); padding: 30px; border-radius: 15px; border: 1px solid #333; width: 300px; text-align: center; }
        .btn-large { padding: 15px; width: 100%; font-size: 20px; font-weight: bold; background: var(--team-green); color: black; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
        input[type="text"], select { padding: 15px; background: #000; border: 1px solid #444; color: white; font-size: 18px; text-align: center; border-radius: 8px; outline: none; width: 100%; margin-bottom: 10px; box-sizing: border-box; }

        #game-interface { display: none; width: 100%; height: 100%; flex-direction: column; }
        #header { height: 60px; background: #111; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        #main-container { display: flex; flex: 1; overflow: hidden; }
        #sidebar { width: 250px; background: #0a0a0a; border-right: 1px solid #222; overflow-y: auto; padding: 10px; }
        #game-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #rooms-grid { display: grid; gap: 10px; padding: 20px; max-width: 800px; width: 100%; max-height: 80vh; overflow-y: auto; }

        .room-btn { aspect-ratio: 1; background: #1e1e1e; border: 1px solid #333; border-radius: 8px; color: #555; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.1s; }
        .room-btn:hover { border-color: #777; }
        .room-btn.taken { opacity: 0.5; cursor: not-allowed; }
        .room-btn.gas { background: #2e1e05; border-color: red; }
        .room-btn.vida { background: #052e05; border-color: green; }
        .room-btn.escudo { background: #002233; border-color: blue; }
        .room-content { font-size: 30px; }
        .room-number { position: absolute; top: 5px; left: 8px; font-weight: bold; font-size: 14px; opacity: 0.5; }
        .occupant-name { font-size: 12px; margin-top: 5px; color: #aaa; font-weight: bold; }

        #message-box { font-size: 24px; font-weight: bold; margin-bottom: 10px; height: 35px; text-shadow: 0 2px 10px black; }
        #victory-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center; z-index: 50; }
    </style>
</head>
<body>

    <button id="btn-admin-toggle" onclick="abrirAdmin()">‚öôÔ∏è</button>
    <div class="online-badge">ONLINE: <span id="online-count">1</span></div>

    <div id="betting-modal">
        <div class="bet-title">APOSTE NO VENCEDOR</div>
        <div class="bet-container">
            <div class="bet-btn" id="bet-p1" onclick="apostar(1)"><span id="name-p1">P1</span></div>
            <div style="font-size:30px; color:white; align-self:center;">VS</div>
            <div class="bet-btn" id="bet-p2" onclick="apostar(2)"><span id="name-p2">P2</span></div>
        </div>
        <div style="margin-top:20px; color:#ff1744;">ERROU A APOSTA = MORTE (SE SEM ESCUDO)</div>
    </div>

    <div id="board-overlay">
        <h2 style="color:gold; margin:0;">DUELO FINAL</h2>
        <div id="board-msg">VS</div>
        <div class="board-track" id="board-track"></div>
        <div id="dice-area">
            <button id="dice-btn" onclick="rolarDado()">üé≤</button>
        </div>
    </div>

    <div id="voting-modal">
        <div style="font-size:30px; color:white; margin-bottom:10px;">QUEM VAI PRO PARED√ÉO?</div>
        <div class="vote-grid" id="vote-list"></div>
        <div style="margin-top:10px; color:#aaa;" id="vote-status">Aguardando...</div>
    </div>

    <div id="admin-panel">
        <div class="admin-card">
            <h2 style="color:white; margin:0;">ADMIN</h2>
            <div id="admin-login-area">
                <div class="admin-row"><label>Senha:</label><input type="password" id="admin-pass"></div>
                <button class="btn-admin" onclick="tentarLoginAdmin()">ENTRAR</button>
                <button class="btn-admin" onclick="fecharAdmin()">FECHAR</button>
            </div>
            <div id="admin-controls" style="display:none;">
                <div class="admin-row"><label>Max Jogadores:</label><input type="number" id="conf-max" value="20"></div>
                <button class="btn-admin" onclick="salvarConfig()">SALVAR</button>
                <button class="btn-admin" onclick="zerarRank()">ZERAR RANK</button>
                <button class="btn-admin" onclick="fecharAdmin()">FECHAR</button>
            </div>
        </div>
    </div>

    <div id="main-menu">
        <div class="logo-title">SURVIVAL TEAMS</div>
        <div class="menu-card" id="login-step">
            <h3 style="margin:0 0 20px 0; color:#aaa;">ENTRAR</h3>
            <input type="text" id="my-name" placeholder="NICKNAME" maxlength="12">
            <select id="my-color">
                <option value="p1">Equipe Verde</option>
                <option value="p2">Equipe Azul</option>
                <option value="p3">Equipe Vermelha</option>
                <option value="p4">Equipe Amarela</option>
            </select>
            <button class="btn-large" onclick="entrarNoLobby()">JOGAR</button>
            <div class="hall-fama-container" style="margin-top:20px;">
                <div style="color:gold;">üèÜ VENCEDORES</div>
                <div id="rank-list-ui"></div>
            </div>
        </div>
        <div class="menu-card" id="lobby-step" style="display:none;">
            <h3>SALA DE ESPERA</h3>
            <div id="lobby-list" style="background:#000; padding:10px; height:100px; overflow-y:auto;"></div>
            <button id="btn-start" class="btn-large" style="background:gold; display:none;" onclick="iniciarJogo()">INICIAR</button>
            <div id="lobby-msg">Aguardando Host...</div>
        </div>
    </div>

    <div id="game-interface">
        <div id="header">
            <button onclick="location.reload()">SAIR</button>
            <div id="timer-txt" style="color:gold; font-size:20px; font-weight:bold;">--</div>
            <div>VIVOS: <span id="alive-txt">0</span></div>
        </div>
        <div id="main-container">
            <div id="sidebar"><div id="game-players-list"></div></div>
            <div id="game-area"><div id="message-box"></div><div id="rooms-grid"></div></div>
        </div>
    </div>

    <div id="victory-screen">
        <h1 style="color:gold; font-size:50px;">VENCEDOR</h1>
        <h2 id="winner-name" style="color:white;">-</h2>
        <button class="btn-large" style="width:200px;" onclick="location.reload()">VOLTAR</button>
    </div>

    <script>
        const socket = io();
        let meuId=null, minhaVez=false; timerVisual=null; let apostaP1Id=null, apostaP2Id=null;
        const SFX={click:()=>playTone(600,'sine',0.1),dice:()=>playTone(400,'square',0.1),win:()=>playTone(600,'sine',0.6)};
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(f,t,d){if(audioCtx.state==='suspended')audioCtx.resume();const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.type=t;o.frequency.setValueAtTime(f,audioCtx.currentTime);g.gain.setValueAtTime(0.1,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+d);o.connect(g);g.connect(audioCtx.destination);o.start();o.stop(audioCtx.currentTime+d);}

        function abrirAdmin(){document.getElementById('admin-panel').style.display='flex';}
        function fecharAdmin(){document.getElementById('admin-panel').style.display='none';}
        function tentarLoginAdmin(){socket.emit('adminLogin',document.getElementById('admin-pass').value);}
        socket.on('adminLogado',(ok)=>{if(ok){document.getElementById('admin-login-area').style.display='none';document.getElementById('admin-controls').style.display='block';}});
        function salvarConfig(){socket.emit('adminSalvarConfig',{maxJogadores:document.getElementById('conf-max').value});fecharAdmin();}
        function zerarRank(){socket.emit('adminZerarRank');}

        socket.on('connect',()=>{meuId=socket.id;});
        socket.on('jogadoresOnline',(n)=>document.getElementById('online-count').innerText=n);
        socket.on('atualizarRanking',(l)=>{document.getElementById('rank-list-ui').innerHTML=l.map(r=>`<div>${r.nome}</div>`).join('');});

        function entrarNoLobby(){
            socket.emit('entrar',{nome:document.getElementById('my-name').value,tipo:document.getElementById('my-color').value});
            document.getElementById('login-step').style.display='none';document.getElementById('lobby-step').style.display='block';
            SFX.click();
        }
        function iniciarJogo(){socket.emit('iniciarJogo');}

        socket.on('atualizarLista',(jogadores)=>{
            document.getElementById('lobby-list').innerHTML=jogadores.map(j=>`<div style="color:${j.id===meuId?'lime':'white'}">${j.nome}</div>`).join('');
            if(jogadores.length>0&&jogadores[0].id===meuId){document.getElementById('btn-start').style.display='block';document.getElementById('lobby-msg').style.display='none';}
            const gl=document.getElementById('game-players-list');gl.innerHTML='';
            jogadores.forEach(p=>{
                let d=document.createElement('div');d.className=`player-item ${p.tipo}`;d.id=`plist-${p.id}`;
                if(!p.vivo)d.classList.add('dead');
                let st = p.vivo ? "‚ù§Ô∏è".repeat(p.vidas) : "üíÄ";
                if(p.temEscudo) st = "üõ°Ô∏è";
                d.innerHTML=`<div>${p.nome}</div><div>${st}</div>`;
                gl.appendChild(d);
            });
            document.getElementById('alive-txt').innerText=jogadores.filter(j=>j.vivo).length;
        });

        // VOTA√á√ÉO
        socket.on('abrirVotacao', (candidatos) => {
            document.getElementById('voting-modal').style.display='flex';
            let l=document.getElementById('vote-list');l.innerHTML='';
            candidatos.forEach(c=>{
                let b=document.createElement('button');b.className='vote-btn';b.innerText=c.nome;
                b.onclick=()=>{socket.emit('enviarVoto',c.id);document.getElementById('vote-status').innerText="Voto Enviado!";document.querySelectorAll('.vote-btn').forEach(bb=>bb.disabled=true);SFX.click();};
                l.appendChild(b);
            });
        });
        socket.on('progressoVotacao',(d)=>document.getElementById('vote-status').innerText=`Votos: ${d.atual}/${d.total}`);
        socket.on('fecharVotacao',()=>document.getElementById('voting-modal').style.display='none');

        // APOSTAS
        socket.on('abrirApostasUI',(d)=>{
            apostaP1Id=d.p1.id; apostaP2Id=d.p2.id;
            document.getElementById('betting-modal').style.display='flex';
            document.getElementById('name-p1').innerText=d.p1.nome; document.getElementById('name-p2').innerText=d.p2.nome;
            document.getElementById('bet-p1').classList.remove('selected'); document.getElementById('bet-p2').classList.remove('selected');
        });
        function apostar(n){ socket.emit('fazerAposta', n===1?apostaP1Id:apostaP2Id); document.getElementById(`bet-p${n}`).classList.add('selected'); SFX.click(); }
        socket.on('fecharApostasUI',()=>document.getElementById('betting-modal').style.display='none');

        // BOARD
        let boardP1, boardP2;
        socket.on('iniciarBoardUI',(d)=>{
            boardP1=d.p1.id; boardP2=d.p2.id;
            document.getElementById('board-overlay').style.display='flex';
            document.getElementById('board-msg').innerText = `${d.p1.nome} VS ${d.p2.nome}`;
            let t=document.getElementById('board-track');t.innerHTML='';
            for(let i=0;i<=d.tamanho;i++){
                let c=document.createElement('div');c.className='board-cell';c.innerText=i;
                if(i===13||i===7)c.classList.add('trap'); if(i===d.tamanho)c.classList.add('finish');
                let tk1=document.createElement('div');tk1.className='p-token';tk1.id=`bt-p1-${i}`;tk1.style.background='var(--team-green)';tk1.style.left='2px';tk1.style.display='none';
                let tk2=document.createElement('div');tk2.className='p-token';tk2.id=`bt-p2-${i}`;tk2.style.background='var(--team-blue)';tk2.style.right='2px';tk2.style.display='none';
                c.appendChild(tk1);c.appendChild(tk2);t.appendChild(c);
            }
            document.getElementById(`bt-p1-0`).style.display='flex';document.getElementById(`bt-p2-0`).style.display='flex';
        });
        socket.on('vezBoard',(d)=>{
            let b=document.getElementById('dice-btn');
            if(d.id===meuId){b.disabled=false;b.innerText='üé≤';document.getElementById('board-msg').innerText="SUA VEZ!";}
            else{b.disabled=true;b.innerText='‚è≥';document.getElementById('board-msg').innerText=`VEZ DE ${d.nome}`;}
        });
        function rolarDado(){socket.emit('pedirDado');SFX.click();}
        socket.on('dadoRolado',(d)=>{
            SFX.dice(); document.getElementById('dice-btn').innerText=d.dado;
            let s=(d.id===boardP1)?'p1':'p2';
            for(let i=0;i<=20;i++){let t=document.getElementById(`bt-${s}-${i}`);if(t)t.style.display='none';}
            let n=document.getElementById(`bt-${s}-${d.pos}`);if(n)n.style.display='flex';
        });
        socket.on('fecharBoardUI',()=>document.getElementById('board-overlay').style.display='none');

        // GAME
        socket.on('inicioDePartida',(d)=>{document.getElementById('main-menu').style.display='none';document.getElementById('game-interface').style.display='flex';renderGrid(d.salas);});
        socket.on('novaRodada',(d)=>{document.getElementById('board-overlay').style.display='none';renderGrid(d.salas);document.getElementById('message-box').innerText=`RODADA ${d.fase}`;});
        socket.on('mudancaDeTurno',(d)=>{
            minhaVez=(d.idJogador===meuId);
            let t=d.tempo; document.getElementById('timer-txt').innerText=t;
            document.querySelectorAll('.player-item').forEach(e=>e.classList.remove('turn'));
            if(document.getElementById(`plist-${d.idJogador}`))document.getElementById(`plist-${d.idJogador}`).classList.add('turn');
            let m=document.getElementById('message-box');
            if(minhaVez){m.innerText="SUA VEZ!";m.style.color="lime";}else{m.innerText=`VEZ DE ${d.nome}`;m.style.color="white";}
            clearInterval(timerVisual);timerVisual=setInterval(()=>{t--;document.getElementById('timer-txt').innerText=t;if(t<=0)clearInterval(timerVisual);},1000);
        });
        socket.on('salaOcupada',(d)=>{
            let b=document.getElementById(`room-${d.idSala}`);b.classList.add('taken');
            let ico='üö™';if(d.efeito==='gas')ico='‚ò†Ô∏è';if(d.efeito==='vida')ico='‚ù§Ô∏è';if(d.efeito==='escudo')ico='üõ°Ô∏è';
            b.innerHTML=`<div style="font-size:24px">${ico}</div><div style="font-size:10px">${d.jogador.nome}</div>`;
            b.classList.add(d.efeito);
        });
        socket.on('mensagem',(d)=>{let m=document.getElementById('message-box');m.innerText=d.texto;m.style.color=d.cor;});
        socket.on('fimDeJogo',(d)=>{document.getElementById('victory-screen').style.display='flex';document.getElementById('winner-name').innerText=d.campeao.nome;SFX.win();});

        function renderGrid(salas){
            let g=document.getElementById('rooms-grid');g.innerHTML='';
            let cols=window.innerWidth<600?4:5; g.style.gridTemplateColumns=`repeat(${cols}, 1fr)`;
            salas.forEach(s=>{
                let b=document.createElement('div');b.className='room-btn';b.id=`room-${s.id}`;
                b.onclick=()=>{if(minhaVez)socket.emit('jogarTurno',s.id);};
                b.innerHTML=`<div style="font-size:12px;opacity:0.5">${s.id}</div><div class="room-content">üö™</div>`;
                g.appendChild(b);
            });
        }
    </script>
</body>
</html>
